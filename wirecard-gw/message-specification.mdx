---
title: 'Message Specification'
description: 'How to Create and Transmit Messages to WD-Security Gateway'
---
## General

The format of the message to send to WD-Security Gateway is shown as below:
!["WD Gateway Message Format"](./images/wirecard-gw/wd-msg-format.png)


## Field Tag List

<AccordionGroup>
  <Accordion title="TAG_CIPHER_INFO = 0xA550">
    This field has 3 bytes, most used standards are `0x030011` & `0x020011`
    | Byte | Description | Valid values |
    | ---- | ----------- | ----------- |
    | 1st  | Cipher type | `0x01`: DES | 
    |      |             | `0x02`: DES 16 bytes (most used) |
    |      |             | `0x03`: 3DES 24 bytes (most used) | 
    |      |             | `0x04`: RC2 | 
    |      |             | `0x05`: AES |
    | 2nd  | Cipher mode | `0x00`: CBC (most used)|
    |      |             | `0x01`: CFB |
    |      |             | `0x02`: CTS |
    |      |             | `0x03`: ECB |
    | 3rd  | Hash algorithm | `0x11`: SHA1 (most used) |
    |      |                | `0x22`: MD5 |
  </Accordion>

  <Accordion title="TAG_MESSAGETYPE = 0xA551">
    | Message type | Value |
    | ------------ | ----- |
    | LOGON_REQUEST | `0x0008` |
    | LOGON_RESPONSE | `0x1008` |
    | NORMAL_REQUEST | `0x0001` |
    | NORMAL_RESPONSE | `0x1001` |
  </Accordion>

  <Accordion title="TAG_LENGTH_OF_MESSAGE = 0xA552">
    2 bytes in BCD indicate actual length of raw message.
    <Note> 
        If RAW_MESSAGE is `0046600032000508002020010000c0000090000000007003203031313030313930313131313131313131313131313131`, the TAG_LENGTH_OF_MESSAGE will be `0x0048`
    </Note>
  </Accordion>

  <Accordion title="TAG_ENCRYPTED_CSK = 0xA553">
    CSK (client signature key) is hashed password. 
    When it is transmitted, it is encrypted by DEK in normal request, or by KEK in logon request
    <Note> 
      Remember to convert password to **ASCII format** before hashing

      eg. if password is `00000`, let convert to `3030303030`
    </Note>
  </Accordion>
  
  <Accordion title="TAG_ENCRYPTED_MAC = 0xA554">
    MAC is message authentication code. MAC is generated by hashed raw
    message with SHA1/MD5. If raw message 's size is not multiplier of 8, it will
    be padded with zero. When it is transmitted, it is encrypted by MPK and
    CBC mode.

    ```java Sample
      // Hash RAW_MESSAGE using SHA1 algorithm
      String hashedRawMsg = HashSHA1(RAW_MESSAGE);
      // Pad right with zero if hashedRawMsg is not multiplier of 8
      int hashedRawMsgLength8 = (int) Math.ceil((double)hashedRawMsg.length()/16)*8;
      hashedRawMsg = ISOUtil.padright(hashedRawMsg, hashedRawMsgLength8*2, '0');
      // Encrypt hashedRawMsg with MPK
      String ENCRYPTED_MAC = DES3Encrypt(hashedRawMsg, MPK);
      ENCRYPTED_MAC = "a554" + Integer.toHexString(ENCRYPTED_MAC.length()/2) + ENCRYPTED_MAC;
    ```
  </Accordion>
  
  <Accordion title="TAG_CLIENTID = 0xA555">
    Size = 8 bytes. It is similar to terminal ID, get from `Field 41` of ISO8583 message. 
    <Note> 
      If client ID is `01100190`, CLIENT_ID will be `3031313030313930`
    </Note>
  </Accordion>

  <Accordion title="TAG_MERCHANTID = 0xA556">
    Size = 15 bytes. It is similar to merchant ID, get from `Field 42` of ISO8583 message. 
    <Note> 
      If merchant ID is `111111111111111`, MERCHANT_ID will be `313131313131313131313131313131`
    </Note>
  </Accordion>

  <Accordion title="TAG_ENCRYPTED_DEK = 0xA563">
    DEK is encrypted by KEK. Size's field depends on key's size of current algorithm.
  </Accordion>

  <Accordion title="TAG_ENCRYPTED_MPK = 0xA564">
    MPK is encrypted by KEK. Size's field depends on key's size of current algorithm.
  </Accordion>

  <Accordion title="TAG_ERROR_CODE = 0xA565">
    Transmission is declined if error code returned is not “00”. There are many possible error codes below:
    | Message | Code || Message | Code |
    | --------| ---- |-| ------- | ---- |
    | DatabaseError | `0C00` || Others | `0300` |
    | Declined | `3433` || ReceiveFromDestinationErr | `0800` |
    | DisconnectedFromDestination | `0200` || ReceiveFromSourceErr | `0700` |
    | DisconnectedFromSource | `0100` || ReleaseConnection | `3A33` |
    | ExceptionHandled | `3933` || SocketError | `3733` |
    | InvalidNII | `3633` || TimeOut | `0600` |
    | MessageLengthError | `0500` || Unknown | `0400` |
    | NoError | `0000` || WrongConfiguration | `0D00` |
    | NoLicense | `3533` || WrongHeader | `0900` |
    | NotSendLogonBefore | `3333` || WrongMAC | `0E00` |
    | WrongSignature | `0A00` || PackDataError | `0B00` |
  </Accordion>
</AccordionGroup>